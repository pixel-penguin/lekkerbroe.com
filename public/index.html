<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Topdown Driver</title>
    <style>
        html, body {
            margin:0;
            padding:0;
            background:#111;
            color:#fff;
            font-family:sans-serif;
            overflow:hidden;
        }
        #gameCanvas {
            display:block;
            margin:0 auto;
            background:#444;
            border:4px solid #fff;
        }
        .hud {
            position:absolute;
            top:10px;
            left:10px;
            font-size:20px;
        }
        #message {
            position:absolute;
            top:50%;
            left:50%;
            transform:translate(-50%,-50%);
            font-size:32px;
            background:rgba(0,0,0,0.7);
            padding:20px;
            border-radius:10px;
            display:none;
        }
    </style>
</head>
<body>
<canvas id="gameCanvas" width="400" height="600"></canvas>
<div class="hud">Score: <span id="score">0</span></div>
<div id="message">Press any key to start</div>
<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
let playing = false;
let score = 0;

const car = {x:canvas.width/2-15, y:canvas.height-80, w:30, h:50, speed:4, color:'#0f0'};
const obstacles = [];
let obstacleTimer = 0;

const keys = {};
document.addEventListener('keydown', e => {
    keys[e.key] = true;
    if(!playing){
        startGame();
    }
});
document.addEventListener('keyup', e => { keys[e.key] = false; });

function startGame(){
    document.getElementById('message').style.display='none';
    playing = true;
    score = 0;
    obstacles.length = 0;
    obstacleTimer = 0;
    requestAnimationFrame(loop);
}

function spawnObstacle(){
    const width = 40 + Math.random()*40;
    const x = Math.random()*(canvas.width-width);
    const speed = 2 + Math.random()*3;
    obstacles.push({x, y:-60, w:width, h:40, speed, color:'#f00'});
}

function update(){
    // move car
    if(keys['ArrowLeft']) car.x -= car.speed;
    if(keys['ArrowRight']) car.x += car.speed;
    if(keys['ArrowUp']) car.y -= car.speed;
    if(keys['ArrowDown']) car.y += car.speed;

    // keep in bounds
    car.x = Math.max(0, Math.min(canvas.width-car.w, car.x));
    car.y = Math.max(0, Math.min(canvas.height-car.h, car.y));

    obstacleTimer--;
    if(obstacleTimer <= 0){
        spawnObstacle();
        obstacleTimer = 60;
    }

    // move obstacles
    for(let i=obstacles.length-1;i>=0;i--){
        const ob=obstacles[i];
        ob.y += ob.speed;
        if(ob.y > canvas.height){
            obstacles.splice(i,1);
            score += 10;
        }else if(checkCollision(car, ob)){
            gameOver();
            return;
        }
    }
}

function checkCollision(a,b){
    return a.x < b.x + b.w && a.x + a.w > b.x && a.y < b.y + b.h && a.y + a.h > b.y;
}

function draw(){
    ctx.fillStyle = '#111';
    ctx.fillRect(0,0,canvas.width,canvas.height);

    // draw road
    ctx.fillStyle = '#555';
    ctx.fillRect(80,0,canvas.width-160,canvas.height);
    ctx.strokeStyle = '#fff';
    ctx.lineWidth = 2;
    for(let y=0;y<canvas.height;y+=40){
        ctx.beginPath();
        ctx.moveTo(canvas.width/2, y);
        ctx.lineTo(canvas.width/2, y+20);
        ctx.stroke();
    }

    // draw car
    ctx.fillStyle = car.color;
    ctx.fillRect(car.x,car.y,car.w,car.h);

    // draw obstacles
    obstacles.forEach(o=>{
        ctx.fillStyle=o.color;
        ctx.fillRect(o.x,o.y,o.w,o.h);
    });

    document.getElementById('score').textContent = score;
}

function loop(){
    if(!playing) return;
    update();
    draw();
    requestAnimationFrame(loop);
}

function gameOver(){
    playing=false;
    document.getElementById('message').textContent='Game Over! Score: '+score+' - press any key to restart';
    document.getElementById('message').style.display='block';
}

document.getElementById('message').style.display='block';
</script>
</body>
</html>
